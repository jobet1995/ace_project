{% extends "base.html" %}
{% load static wagtailcore_tags wagtailimages_tags %}

{% block body_class %}template-homepage{% endblock %}

{% block extra_css %}
<!-- Bootstrap 5 CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<!-- Bootstrap Icons -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
<!-- Swiper CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css">
<!-- Custom CSS -->
<link rel="stylesheet" type="text/css" href="{% static 'css/home_page.css' %}">
<style>
  /* Additional custom styles for Bootstrap version */
  .hero-section {
    position: relative;
    height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    text-align: center;
    color: white;
    background-size: cover;
    background-position: center;
  }

  .hero-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
  }

  .hero-content {
    position: relative;
    z-index: 2;
    max-width: 800px;
  }

  .service-card {
    transition: transform 0.3s, box-shadow 0.3s;
    height: 100%;
  }

  .service-card:hover {
    transform: translateY(-10px);
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
  }

  .service-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
    color: #0d6efd;
  }

  .stats-section {
    background: linear-gradient(135deg, #0d6efd, #0b5ed7);
    color: white;
  }

  .stat-number {
    font-size: 3rem;
    font-weight: bold;
  }

  .testimonial-card {
    border: none;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
  }

  .partner-logo {
    filter: grayscale(100%);
    transition: filter 0.3s;
    max-width: 150px;
    margin: 0 auto;
  }

  .partner-logo:hover {
    filter: grayscale(0%);
  }

  .blog-card {
    transition: transform 0.3s;
  }

  .blog-card:hover {
    transform: translateY(-5px);
  }

  .cta-section {
    background: linear-gradient(135deg, #0d6efd, #0b5ed7);
    color: white;
  }

  .swiper {
    padding: 2rem 0;
  }

  .swiper-pagination-bullet-active {
    background: #0d6efd;
  }

  .animate-on-scroll {
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.6s ease-out, transform 0.6s ease-out;
  }

  .animate-on-scroll.visible {
    opacity: 1;
    transform: translateY(0);
  }
</style>
{% endblock %}

{% block content %}
<!-- Hero Section -->
{% if page.hero_section %}
  {% for block in page.hero_section %}
    <section class="hero-section" 
             {% if block.value.background_image %}{% image block.value.background_image fill-1920x1080 as bg_image %}style="background-image: url('{{ bg_image.url }}');"{% endif %}>
      <div class="hero-overlay"></div>
      <div class="hero-content container">
        <h1 class="display-3 fw-bold mb-3">{{ block.value.headline }}</h1>
        {% if block.value.subheadline %}
          <p class="lead mb-4">{{ block.value.subheadline }}</p>
        {% endif %}
        {% if block.value.cta_text and block.value.cta_link %}
          <a href="{{ block.value.cta_link }}" class="btn btn-light btn-lg px-4 py-2 fw-bold">{{ block.value.cta_text }}</a>
        {% endif %}
      </div>
    </section>
  {% endfor %}
{% endif %}

<!-- Services Overview -->
{% if page.services_overview %}
  <section class="services-section py-5 bg-light">
    <div class="container">
      <div class="row mb-5">
        <div class="col-12 text-center">
          <h2 class="display-5 fw-bold mb-3">Our Services</h2>
          <p class="lead text-muted">Discover the range of services we offer to help your business thrive</p>
        </div>
      </div>
      <div class="row g-4">
        {% for block in page.services_overview %}
          <div class="col-lg-3 col-md-6 animate-on-scroll">
            <div class="card service-card h-100 border-0 shadow-sm p-4">
              {% if block.value.icon %}
                {% image block.value.icon fill-100x100 as service_icon %}
                <img src="{{ service_icon.url }}" alt="{{ block.value.title }}" class="service-icon mb-3 mx-auto">
              {% else %}
                <i class="bi bi-grid service-icon text-center d-block"></i>
              {% endif %}
              <h3 class="h5 fw-bold text-center">{{ block.value.title }}</h3>
              <p class="text-muted text-center">{{ block.value.description }}</p>
              {% if block.value.link %}
                <a href="{% pageurl block.value.link %}" class="btn btn-outline-primary w-100 mt-auto">Learn more</a>
              {% endif %}
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
  </section>
{% endif %}

<!-- About Preview -->
{% if page.about_preview %}
  <section class="about-section py-5">
    <div class="container">
      <div class="row align-items-center">
        {% for block in page.about_preview %}
          <div class="col-lg-6 animate-on-scroll">
            {{ block.value.summary_text|richtext }}
            <a href="{% url 'about' %}" class="btn btn-primary mt-3">Learn More About Us</a>
          </div>
          {% if block.value.image %}
            <div class="col-lg-6 animate-on-scroll">
              {% image block.value.image width-500 class="img-fluid rounded shadow" %}
            </div>
          {% endif %}
        {% endfor %}
      </div>
    </div>
  </section>
{% endif %}

<!-- Key Stats Section -->
{% if page.key_stats %}
  <section class="stats-section py-5">
    <div class="container">
      <div class="row text-center">
        {% for block in page.key_stats %}
          <div class="col-lg-3 col-md-6 mb-4 animate-on-scroll">
            <div class="stat-item">
              <div class="stat-number" data-count="{{ block.value.number }}">0</div>
              <div class="stat-label h5">{{ block.value.label }}</div>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
  </section>
{% endif %}

<!-- Testimonials Slider -->
{% if page.testimonials_slider %}
  <section class="testimonials-section py-5 bg-light">
    <div class="container">
      <div class="row mb-5">
        <div class="col-12 text-center">
          <h2 class="display-5 fw-bold mb-3">What Our Clients Say</h2>
          <p class="lead text-muted">Don't just take our word for it - hear from our satisfied clients</p>
        </div>
      </div>
      
      <div class="row">
        <div class="col-12">
          <div class="swiper testimonials-swiper">
            <div class="swiper-wrapper">
              {% for block in page.testimonials_slider %}
                <div class="swiper-slide">
                  <div class="card testimonial-card h-100 border-0 p-4 mx-2">
                    <div class="card-body">
                      <p class="card-text fst-italic">"{{ block.value.testimonial.quote }}"</p>
                    </div>
                    <div class="card-footer bg-transparent border-0">
                      <div class="d-flex align-items-center">
                        {% if block.value.testimonial.image %}
                          {% image block.value.testimonial.image fill-60x60 class="rounded-circle me-3" %}
                        {% else %}
                          <div class="bg-secondary rounded-circle me-3 d-flex align-items-center justify-content-center" style="width: 60px; height: 60px;">
                            <i class="bi bi-person text-white"></i>
                          </div>
                        {% endif %}
                        <div>
                          <h5 class="mb-0">{{ block.value.testimonial.name }}</h5>
                          {% if block.value.testimonial.role %}
                            <p class="text-muted mb-0">{{ block.value.testimonial.role }}</p>
                          {% endif %}
                          {% if block.value.testimonial.company %}
                            <p class="text-muted mb-0">{{ block.value.testimonial.company }}</p>
                          {% endif %}
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              {% endfor %}
            </div>
            <div class="swiper-pagination"></div>
          </div>
        </div>
      </div>
    </div>
  </section>
{% endif %}

<!-- Partners Section -->
{% if page.partners_carousel %}
  <section class="partners-section py-5">
    <div class="container">
      <div class="row mb-5">
        <div class="col-12 text-center">
          <h2 class="display-5 fw-bold mb-3">Our Partners</h2>
          <p class="lead text-muted">Trusted by industry leaders and innovators</p>
        </div>
      </div>
      
      <div class="row">
        <div class="col-12">
          <div class="swiper partners-swiper">
            <div class="swiper-wrapper align-items-center">
              {% for block in page.partners_carousel %}
                <div class="swiper-slide">
                  <div class="text-center p-3">
                    {% if block.value.partner.logo %}
                      {% image block.value.partner.logo fill-200x100 class="partner-logo img-fluid" %}
                    {% else %}
                      <div class="bg-light py-5 rounded">
                        <h5 class="text-muted">{{ block.value.partner.name }}</h5>
                      </div>
                    {% endif %}
                  </div>
                </div>
              {% endfor %}
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
{% endif %}

<!-- Blog Highlights -->
{% if page.blog_highlights %}
  <section class="blog-section py-5 bg-light">
    <div class="container">
      {% for block in page.blog_highlights %}
        <div class="row mb-5">
          <div class="col-12 text-center">
            <h2 class="display-5 fw-bold mb-3">{{ block.value.title }}</h2>
            <p class="lead text-muted">Stay updated with our latest insights and news</p>
          </div>
        </div>
      {% endfor %}
      
      <div class="row g-4">
        <!-- This would typically query the latest 3 BlogPage instances -->
        <!-- For demonstration, showing placeholder cards -->
        <div class="col-lg-4 col-md-6 animate-on-scroll">
          <div class="card blog-card h-100 border-0 shadow-sm">
            <div class="bg-light" style="height: 200px;"></div>
            <div class="card-body">
              <span class="badge bg-primary mb-2">Technology</span>
              <h3 class="h5 fw-bold">Latest Industry Trends</h3>
              <p class="text-muted">Discover the latest trends shaping our industry and how we're adapting.</p>
              <a href="#" class="btn btn-outline-primary">Read More</a>
            </div>
          </div>
        </div>
        <div class="col-lg-4 col-md-6 animate-on-scroll">
          <div class="card blog-card h-100 border-0 shadow-sm">
            <div class="bg-light" style="height: 200px;"></div>
            <div class="card-body">
              <span class="badge bg-success mb-2">Company News</span>
              <h3 class="h5 fw-bold">Global Ace Expansion</h3>
              <p class="text-muted">We're excited to announce our expansion into new markets.</p>
              <a href="#" class="btn btn-outline-primary">Read More</a>
            </div>
          </div>
        </div>
        <div class="col-lg-4 col-md-6 animate-on-scroll">
          <div class="card blog-card h-100 border-0 shadow-sm">
            <div class="bg-light" style="height: 200px;"></div>
            <div class="card-body">
              <span class="badge bg-warning mb-2">Case Study</span>
              <h3 class="h5 fw-bold">Client Success Story</h3>
              <p class="text-muted">How we helped a client achieve 200% growth in 6 months.</p>
              <a href="#" class="btn btn-outline-primary">Read More</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
{% endif %}

<!-- Final Call-to-Action -->
{% if page.final_cta %}
  <section class="cta-section py-5">
    <div class="container">
      {% for block in page.final_cta %}
        <div class="row justify-content-center text-center">
          <div class="col-lg-8">
            <h2 class="display-5 fw-bold mb-3">{{ block.value.headline }}</h2>
            {% if block.value.subheadline %}
              <p class="lead mb-4">{{ block.value.subheadline }}</p>
            {% endif %}
            <a href="{{ block.value.cta_link }}" class="btn btn-light btn-lg px-4 py-2 fw-bold">{{ block.value.cta_text }}</a>
          </div>
        </div>
      {% endfor %}
    </div>
  </section>
{% endif %}
{% endblock %}

{% block extra_js %}
<!-- Bootstrap 5 JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<!-- Swiper JS -->
<script src="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.js"></script>
<!-- Custom JS -->
<script>
  // Initialize Swiper for testimonials
  document.addEventListener('DOMContentLoaded', function() {
    const testimonialsSwiper = new Swiper('.testimonials-swiper', {
      slidesPerView: 1,
      spaceBetween: 30,
      loop: true,
      autoplay: {
        delay: 5000,
        disableOnInteraction: false,
      },
      pagination: {
        el: '.swiper-pagination',
        clickable: true,
      },
      breakpoints: {
        768: {
          slidesPerView: 2,
        },
        992: {
          slidesPerView: 3,
        }
      }
    });

    // Initialize Swiper for partners
    const partnersSwiper = new Swiper('.partners-swiper', {
      slidesPerView: 2,
      spaceBetween: 30,
      loop: true,
      autoplay: {
        delay: 3000,
        disableOnInteraction: false,
      },
      breakpoints: {
        576: {
          slidesPerView: 3,
        },
        768: {
          slidesPerView: 4,
        },
        992: {
          slidesPerView: 6,
        }
      }
    });

    // Animated counters
    function animateCounters() {
      const counters = document.querySelectorAll('.stat-number');
      counters.forEach(counter => {
        const target = +counter.getAttribute('data-count');
        const duration = 2000; // ms
        const increment = target / (duration / 16); // 60fps
        let current = 0;
        
        const updateCounter = () => {
          current += increment;
          if (current < target) {
            counter.innerText = Math.ceil(current);
            setTimeout(updateCounter, 16);
          } else {
            counter.innerText = target;
          }
        };
        
        updateCounter();
      });
    }

    // Intersection Observer for animations
    const observerOptions = {
      root: null,
      rootMargin: '0px',
      threshold: 0.1
    };

    const observer = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add('visible');
          if (entry.target.classList.contains('stat-number')) {
            animateCounters();
          }
        }
      });
    }, observerOptions);

    // Observe elements with animate-on-scroll class
    document.querySelectorAll('.animate-on-scroll').forEach(el => {
      observer.observe(el);
    });

    // Animate stats immediately if they're in view on page load
    document.querySelectorAll('.stats-section .animate-on-scroll').forEach(el => {
      const rect = el.getBoundingClientRect();
      if (rect.top < window.innerHeight && rect.bottom >= 0) {
        el.classList.add('visible');
        animateCounters();
      }
    });
  });
</script>
{% endblock %}